---
layout: page
titles:
  # @start locale config
  en      : &EN       Archive
  en-GB   : *EN
  en-US   : *EN
  en-CA   : *EN
  en-AU   : *EN
  zh-Hans : &ZH_HANS  归档
  zh      : *ZH_HANS
  zh-CN   : *ZH_HANS
  zh-SG   : *ZH_HANS
  zh-Hant : &ZH_HANT  歸檔
  zh-TW   : *ZH_HANT
  zh-HK   : *ZH_HANT
  ko      : &KO       아카이브
  ko-KR   : *KO
  fr      : &FR       Archives
  fr-BE   : *FR
  fr-CA   : *FR
  fr-CH   : *FR
  fr-FR   : *FR
  fr-LU   : *FR
  tr      : &TR       Arşivdekiler
  # @end locale config
---

<div class="layout--archive js-all">
  {%- assign all_posts = site.posts | concat: site.physics | concat: site.animation | concat: site.practice | sort: 'date' | reverse -%}
  
  {%- comment -%} Combine tags from all collections {%- endcomment -%}
  {%- assign all_tags = "" | split: "" -%}
  {%- assign tag_posts = "" | split: "" -%}
  
  {%- comment -%} Get tags from main posts {%- endcomment -%}
  {%- for tag in site.tags -%}
    {%- assign all_tags = all_tags | push: tag[0] -%}
    {%- assign tag_posts = tag_posts | push: tag[1] -%}
  {%- endfor -%}
  
  {%- comment -%} Get tags from physics posts {%- endcomment -%}
  {%- for post in site.physics -%}
    {%- for tag in post.tags -%}
      {%- unless all_tags contains tag -%}
        {%- assign all_tags = all_tags | push: tag -%}
        {%- assign posts_with_tag = site.physics | where: "tags", tag -%}
        {%- assign tag_posts = tag_posts | push: posts_with_tag -%}
      {%- endunless -%}
    {%- endfor -%}
  {%- endfor -%}
  
  {%- comment -%} Get tags from animation posts {%- endcomment -%}
  {%- for post in site.animation -%}
    {%- for tag in post.tags -%}
      {%- unless all_tags contains tag -%}
        {%- assign all_tags = all_tags | push: tag -%}
        {%- assign posts_with_tag = site.animation | where: "tags", tag -%}
        {%- assign tag_posts = tag_posts | push: posts_with_tag -%}
      {%- endunless -%}
    {%- endfor -%}
  {%- endfor -%}

  {%- comment -%} Get tags from practice posts {%- endcomment -%}
  {%- for post in site.practice -%}
    {%- for tag in post.tags -%}
      {%- unless all_tags contains tag -%}
        {%- assign all_tags = all_tags | push: tag -%}
        {%- assign posts_with_tag = site.practice | where: "tags", tag -%}
        {%- assign tag_posts = tag_posts | push: posts_with_tag -%}
      {%- endunless -%}
    {%- endfor -%}
  {%- endfor -%}
  
  {%- comment -%} Calculate tag sizes {%- endcomment -%}
  {%- assign _tag_max_size = 1 -%}
  {%- assign _tag_min_size = 1 -%}
  {%- for tag in all_tags -%}
    {%- assign posts_with_tag = all_posts | where: "tags", tag -%}
    {%- assign tag_size = posts_with_tag | size -%}
    {%- if tag_size > _tag_max_size -%}
      {%- assign _tag_max_size = tag_size -%}
    {%- endif -%}
    {%- if tag_size < _tag_min_size -%}
      {%- assign _tag_min_size = tag_size -%}
    {%- endif -%}
  {%- endfor -%}
  
  {%- assign _tag_gap_size = _tag_max_size | minus: _tag_min_size | plus: 1 | divided_by: 4 -%}
  {%- if _tag_gap_size < 1 -%}
    {%- assign _tag_gap_size = 1 -%}
  {%- endif -%}
  
  <div class="site-tags js-tags">
    <ul class="menu">
      <li>
        <button type="button" class="button button--secondary button--pill tag-button tag-button--all" data-encode="">
          Show All<div class="tag-button__count">{{ all_posts | size }}</div>
        </button>
      </li>
      {%- for tag in all_tags -%}
        {%- assign posts_with_tag = all_posts | where: "tags", tag -%}
        {%- assign _tag_cur_size = posts_with_tag | size -%}
        {%- assign _tag_min_1 = _tag_min_size -%}
        {%- assign _tag_max_1 = _tag_min_1 | plus: _tag_gap_size -%}
        {%- assign _tag_min_2 = _tag_max_1 -%}
        {%- assign _tag_max_2 = _tag_min_2 | plus: _tag_gap_size -%}
        {%- assign _tag_min_3 = _tag_max_2 -%}
        {%- assign _tag_max_3 = _tag_min_3 | plus: _tag_gap_size -%}
        {%- assign _tag_min_4 = _tag_max_3 -%}
        {%- assign _tag_max_4 = _tag_min_4 | plus: _tag_gap_size -%}
        {%- if _tag_cur_size >= _tag_min_1 and _tag_cur_size < _tag_max_1 -%}
          {%- assign _c_index = 1 -%}
        {%- elsif _tag_cur_size >= _tag_min_2 and _tag_cur_size < _tag_max_2 -%}
          {%- assign _c_index = 2 -%}
        {%- elsif _tag_cur_size >= _tag_min_3 and _tag_cur_size < _tag_max_3 -%}
          {%- assign _c_index = 3 -%}
        {%- elsif _tag_cur_size >= _tag_min_4 and _tag_cur_size < _tag_max_4 -%}
          {%- assign _c_index = 4 -%}
        {%- else -%}
          {%- assign _c_index = 4 -%}
        {%- endif -%}
        <li><button type="button" class="button button--pill tag-button tag-button-{{ _c_index }}" data-encode="{{ tag | strip | url_encode }}">
            <span>{{ tag | strip }}</span><div class="tag-button__count">{{ _tag_cur_size }}</div>
          </button>
        </li>
      {%- endfor -%}
    </ul>
  </div>
  
  <div class="js-result layout--archive__result d-none">
    {%- include article-list.html articles=all_posts type='brief' show_info=true reverse=true group_by='year' -%}
  </div>
</div>

<script>
  {%- include scripts/archieve.js -%}
</script>

{{ content }}
